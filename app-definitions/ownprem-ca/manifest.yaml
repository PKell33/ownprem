name: ownprem-ca
displayName: Smallstep CA
version: 0.27.5
category: system
description: Internal PKI for issuing TLS certificates (step-ca)

# System app flags
system: true
mandatory: true
singleton: true

source:
  type: binary
  downloadUrl: https://dl.smallstep.com/gh-release/certificates/gh-release-header/v0.27.5/step-ca_linux_${ARCH}.tar.gz
  binaryName: step-ca

# Also need the step CLI for management
dependencies:
  - name: step-cli
    downloadUrl: https://dl.smallstep.com/gh-release/cli/gh-release-header/v0.27.4/step_linux_${ARCH}.tar.gz
    binaryName: step

provides:
  - name: ca-https
    port: 8443
    protocol: https
    internal: true
    description: CA API endpoint (ACME and REST)

configSchema:
  - name: ca_name
    label: CA Name
    type: string
    default: "OwnPrem Root CA"
    description: Common Name for the root certificate

  - name: ca_dns
    label: CA DNS Name
    type: string
    default: "ca.ownprem.local"
    description: DNS name for the CA server

  - name: acme_enabled
    label: Enable ACME
    type: boolean
    default: true
    description: Allow services to request certs via ACME protocol

  - name: default_cert_duration
    label: Default Certificate Duration
    type: string
    default: "720h"
    description: Default validity period for issued certificates (720h = 30 days)

  - name: max_cert_duration
    label: Maximum Certificate Duration
    type: string
    default: "8760h"
    description: Maximum validity period allowed (8760h = 1 year)

  - name: root_cert_duration
    label: Root CA Duration (years)
    type: number
    default: 10
    description: Validity period for root CA certificate

logging:
  serviceName: ownprem-ca

dataDirectories:
  - path: /var/lib/step-ca
    description: CA data, certificates, and keys
  - path: /etc/step-ca
    description: CA configuration

serviceUser: step-ca
serviceGroup: step-ca
