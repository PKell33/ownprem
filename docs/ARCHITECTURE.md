# Ownprem - Build Prompt

Self-hosted app deployment and monitoring platform. Single control plane (orchestrator) manages app servers running various services. Web GUI with unified access to all apps.

## Naming

| Concept | Name | Examples |
|---------|------|----------|
| Project | **ownprem** | |
| Orchestrator | **orchestrator** | Always one, runs on core server |
| App Server | **server** | `core`, `server-1`, `server-2` |
| App | **app** | `postgres`, `redis`, `nginx` |

## Architecture Overview

```
                              User
                                │
                                │ https://ownprem.local
                                ▼
┌──────────────────────────────────────────────────────────────────────┐
│                         CORE SERVER                                  │
│                                                                      │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │                    Reverse Proxy (Caddy)                        │ │
│  │  /              → UI                                            │ │
│  │  /api/*         → Orchestrator API                              │ │
│  │  /apps/grafana/ → server-1:3000                                 │ │
│  │  /apps/adminer/ → server-2:8080                                 │ │
│  └────────────────────────────────────────────────────────────────┘ │
│                                                                      │
│  ┌─────────────────┐           ┌─────────────────┐                  │
│  │  Orchestrator   │           │     Agent       │                  │
│  │                 │◄─────────►│                 │                  │
│  │  - REST API     │    WS     │  - Executor     │                  │
│  │  - WebSocket    │           │  - Reporter     │                  │
│  │  - Database     │           │                 │                  │
│  │  - Secrets      │           └────────┬────────┘                  │
│  │  - Proxy Config │                    │                           │
│  └─────────────────┘              ┌─────┴─────┐                     │
│                                   │  postgres │                     │
│                                   └───────────┘                     │
└──────────────────────────────────────────────────────────────────────┘
         │
         │ WebSocket
         │
    ┌────┴─────────────────────────┐
    │                              │
    ▼                              ▼
┌─────────────────┐        ┌─────────────────┐
│    server-1     │        │    server-2     │
│                 │        │                 │
│  ┌───────────┐  │        │  ┌───────────┐  │
│  │   Agent   │  │        │  │   Agent   │  │
│  └─────┬─────┘  │        │  └─────┬─────┘  │
│        │        │        │        │        │
│  ┌─────┴─────┐  │        │  ┌─────┴─────┐  │
│  │  grafana  │  │        │  │   redis   │  │
│  │   nginx   │  │        │  │  adminer  │  │
│  └───────────┘  │        │  └───────────┘  │
└─────────────────┘        └─────────────────┘
```

## Core Principles

1. **Single orchestrator** - One per deployment. Holds all config, secrets, state. Runs on the core server.

2. **Orchestrator always talks to agent** - Even on all-in-one deployments. Same code path everywhere.

3. **Agents are dumb executors** - Receive commands, write files, run scripts, report status. No decision making.

4. **Secrets stay in orchestrator** - Generated by orchestrator, stored encrypted, rendered into config files, pushed to agents.

5. **Single entry point** - Users access orchestrator URL, reverse proxy routes to all app web UIs.

6. **No Docker** - All apps run as native systemd services for better disk I/O.

## Deployment Modes

### All-in-One

Single machine runs everything:

```
┌─────────────────────────────────────┐
│               core                  │
│                                     │
│  ┌─────────────┐  ┌─────────────┐  │
│  │Orchestrator │◄►│    Agent    │  │
│  └─────────────┘  └──────┬──────┘  │
│                          │         │
│                    ┌─────┴─────┐   │
│                    │  postgres │   │
│                    │   redis   │   │
│                    └───────────┘   │
└─────────────────────────────────────┘
```

### Distributed

Multiple machines:

```
┌───────────────────┐  ┌───────────────────┐  ┌───────────────────┐
│       core        │  │     server-1      │  │     server-2      │
│                   │  │                   │  │                   │
│  Orchestrator     │  │      Agent        │  │      Agent        │
│  + Agent          │  │        │          │  │        │          │
│      │            │  │   ┌────┴────┐     │  │   ┌────┴────┐     │
│ ┌────┴────┐       │  │   │ grafana │     │  │   │  redis  │     │
│ │ postgres │      │  │   │  nginx  │     │  │   │ adminer │     │
│ └─────────┘       │  │   └─────────┘     │  │   └─────────┘     │
└───────────────────┘  └───────────────────┘  └───────────────────┘
```

### Core as Control Only

Orchestrator doesn't run apps:

```
┌───────────────────┐  ┌───────────────────┐  ┌───────────────────┐
│       core        │  │     server-1      │  │     server-2      │
│                   │  │                   │  │                   │
│  Orchestrator     │  │      Agent        │  │      Agent        │
│  (no agent)       │  │        │          │  │        │          │
│                   │  │   ┌────┴────┐     │  │   ┌────┴────┐     │
│                   │  │   │ postgres │    │  │   │  redis  │     │
│                   │  │   │ grafana  │    │  │   └─────────┘     │
│                   │  │   └─────────┘     │  │                   │
└───────────────────┘  └───────────────────┘  └───────────────────┘
```

## Tech Stack

```
Orchestrator (core server):
├── Runtime:    Node.js 20+
├── Language:   TypeScript
├── API:        Express.js
├── Realtime:   Socket.io
├── Database:   SQLite (better-sqlite3)
├── Secrets:    AES-256-GCM encryption
├── Proxy:      Caddy (dynamic config)
└── Templates:  Nunjucks

Agent (all servers):
├── Runtime:    Node.js 20+
├── Language:   TypeScript
├── Connection: Socket.io client
└── Runs as:    systemd service

Frontend:
├── Framework:  React 18+
├── Language:   TypeScript
├── Build:      Vite
├── State:      React Query + Zustand
├── UI:         Tailwind CSS + shadcn/ui
└── Realtime:   Socket.io client

Shared:
├── Types:      TypeScript interfaces
└── Validation: Zod schemas
```

## Project Structure

```
github.com/yourname/ownprem/
├── package.json                    # Monorepo root
├── tsconfig.base.json
├── CLAUDE.md                       # Claude Code instructions
│
├── packages/
│   └── shared/                     # Shared types
│       ├── package.json
│       └── src/
│           ├── types/
│           │   ├── server.ts
│           │   ├── app.ts
│           │   ├── deployment.ts
│           │   ├── service.ts
│           │   └── commands.ts
│           ├── schemas/
│           │   └── manifest.ts
│           └── index.ts
│
├── apps/
│   ├── orchestrator/               # Runs on core server
│   │   ├── package.json
│   │   ├── tsconfig.json
│   │   └── src/
│   │       ├── index.ts
│   │       ├── config.ts
│   │       ├── api/
│   │       │   ├── index.ts
│   │       │   ├── routes/
│   │       │   │   ├── servers.ts
│   │       │   │   ├── apps.ts
│   │       │   │   └── system.ts
│   │       │   └── middleware/
│   │       │       ├── auth.ts
│   │       │       └── error.ts
│   │       ├── websocket/
│   │       │   ├── index.ts
│   │       │   └── agentHandler.ts
│   │       ├── services/
│   │       │   ├── serverManager.ts
│   │       │   ├── appRegistry.ts
│   │       │   ├── deployer.ts
│   │       │   ├── dependencyResolver.ts
│   │       │   ├── secretsManager.ts
│   │       │   ├── configRenderer.ts
│   │       │   ├── serviceRegistry.ts
│   │       │   └── proxyManager.ts
│   │       ├── proxy/
│   │       │   └── caddy.ts
│   │       └── db/
│   │           ├── index.ts
│   │           ├── schema.sql
│   │           └── migrations/
│   │
│   ├── agent/                      # Runs on all servers
│   │   ├── package.json
│   │   ├── tsconfig.json
│   │   └── src/
│   │       ├── index.ts
│   │       ├── connection.ts
│   │       ├── executor.ts
│   │       └── reporter.ts
│   │
│   └── ui/                         # Frontend
│       ├── package.json
│       ├── tsconfig.json
│       ├── vite.config.ts
│       └── src/
│           ├── main.tsx
│           ├── App.tsx
│           ├── api/
│           │   ├── client.ts
│           │   └── websocket.ts
│           ├── stores/
│           │   ├── servers.ts
│           │   └── apps.ts
│           ├── components/
│           │   ├── layout/
│           │   ├── servers/
│           │   └── apps/
│           └── pages/
│               ├── Dashboard.tsx
│               ├── Servers.tsx
│               ├── Apps.tsx
│               └── Settings.tsx
│
├── app-definitions/                # App manifests + scripts
│   ├── mock-app/
│   │   ├── manifest.yaml
│   │   ├── install.sh
│   │   ├── configure.sh
│   │   ├── uninstall.sh
│   │   └── templates/
│   │       └── config.json.njk
│   ├── postgres/
│   │   ├── manifest.yaml
│   │   ├── install.sh
│   │   ├── configure.sh
│   │   └── templates/
│   │       └── postgresql.conf.njk
│   └── redis/
│       └── ...
│
└── scripts/
    ├── install.sh                  # Install orchestrator + agent
    └── bootstrap-server.sh         # Install agent only
```

## Shared Types

```typescript
// packages/shared/src/types/server.ts

export interface Server {
  id: string;                       // 'core', 'server-1', etc.
  name: string;
  host: string | null;              // null for core (local)
  isCore: boolean;
  agentStatus: 'online' | 'offline' | 'error';
  authToken: string | null;         // null for core
  metrics?: ServerMetrics;
  lastSeen: Date | null;
  createdAt: Date;
}

export interface ServerMetrics {
  cpuPercent: number;
  memoryUsed: number;
  memoryTotal: number;
  diskUsed: number;
  diskTotal: number;
  loadAverage: [number, number, number];
}
```

```typescript
// packages/shared/src/types/app.ts

export interface AppManifest {
  name: string;                     // 'postgres', 'redis', etc.
  displayName: string;              // 'PostgreSQL'
  description: string;
  version: string;
  category: 'database' | 'web' | 'networking' | 'monitoring' | 'utility' | 'system';

  source: AppSource;

  provides?: ServiceDefinition[];
  requires?: ServiceRequirement[];

  webui?: WebUI;

  configSchema: ConfigField[];

  resources?: {
    minMemory?: string;
    minDisk?: string;
  };
}

export interface AppSource {
  type: 'binary' | 'git' | 'apt';
  githubRepo?: string;
  downloadUrl?: string;
  checksumUrl?: string;
  gitUrl?: string;
  tagPrefix?: string;
}

export interface ServiceDefinition {
  name: string;                     // 'postgres-db'
  port: number;
  protocol: 'tcp' | 'http';
  credentials?: {
    type: 'rpc' | 'token' | 'password';
    fields: string[];               // ['username', 'password']
  };
}

export interface ServiceRequirement {
  service: string;                  // 'postgres-db'
  optional?: boolean;
  locality: 'same-server' | 'any-server' | 'prefer-same-server';
  injectAs: {
    host?: string;
    port?: string;
    credentials?: Record<string, string>;
  };
}

export interface WebUI {
  enabled: boolean;
  port: number;
  basePath: string;                 // '/apps/grafana'
}

export interface ConfigField {
  name: string;
  type: 'string' | 'number' | 'boolean' | 'select' | 'password';
  label: string;
  description?: string;
  default?: any;
  options?: string[];
  required?: boolean;
  generated?: boolean;
  secret?: boolean;
  inheritFrom?: string;
}
```

```typescript
// packages/shared/src/types/deployment.ts

export interface Deployment {
  id: string;
  serverId: string;
  appName: string;
  version: string;
  config: Record<string, any>;
  status: DeploymentStatus;
  statusMessage?: string;
  installedAt: Date;
  updatedAt: Date;
}

export type DeploymentStatus =
  | 'pending'
  | 'installing'
  | 'configuring'
  | 'running'
  | 'stopped'
  | 'error'
  | 'updating'
  | 'uninstalling';
```

```typescript
// packages/shared/src/types/commands.ts

export interface AgentCommand {
  id: string;
  action: 'install' | 'configure' | 'start' | 'stop' | 'restart' | 'uninstall';
  appName: string;
  payload?: {
    version?: string;
    files?: ConfigFile[];
    env?: Record<string, string>;
  };
}

export interface ConfigFile {
  path: string;
  content: string;
  mode?: string;
  owner?: string;
}

export interface CommandResult {
  commandId: string;
  status: 'success' | 'error';
  message?: string;
  duration?: number;
}

export interface AgentStatusReport {
  serverId: string;
  timestamp: Date;
  metrics: ServerMetrics;
  apps: AppStatus[];
}

export interface AppStatus {
  name: string;
  status: 'running' | 'stopped' | 'error' | 'not-installed';
  version?: string;
}
```

## Database Schema

```sql
-- Servers (all machines including core)
CREATE TABLE servers (
    id TEXT PRIMARY KEY,            -- 'core', 'server-1', etc.
    name TEXT NOT NULL UNIQUE,
    host TEXT,                      -- NULL for core
    is_core BOOLEAN DEFAULT FALSE,
    agent_status TEXT DEFAULT 'offline',
    auth_token TEXT,                -- NULL for core
    metrics JSON,
    last_seen TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- App registry (loaded from app-definitions/)
CREATE TABLE app_registry (
    name TEXT PRIMARY KEY,
    manifest JSON NOT NULL,
    loaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Deployments (apps installed on servers)
CREATE TABLE deployments (
    id TEXT PRIMARY KEY,
    server_id TEXT NOT NULL REFERENCES servers(id) ON DELETE CASCADE,
    app_name TEXT NOT NULL REFERENCES app_registry(name),
    version TEXT NOT NULL,
    config JSON NOT NULL,
    status TEXT DEFAULT 'pending',
    status_message TEXT,
    installed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    UNIQUE(server_id, app_name)
);

-- Secrets (encrypted)
CREATE TABLE secrets (
    deployment_id TEXT PRIMARY KEY REFERENCES deployments(id) ON DELETE CASCADE,
    data TEXT NOT NULL,             -- Encrypted JSON
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Service registry
CREATE TABLE services (
    id TEXT PRIMARY KEY,
    deployment_id TEXT NOT NULL REFERENCES deployments(id) ON DELETE CASCADE,
    service_name TEXT NOT NULL,
    server_id TEXT NOT NULL REFERENCES servers(id),
    host TEXT NOT NULL,
    port INTEGER NOT NULL,
    status TEXT DEFAULT 'available',

    UNIQUE(deployment_id, service_name)
);

CREATE INDEX idx_services_name ON services(service_name);

-- Proxy routes (for web UIs)
CREATE TABLE proxy_routes (
    id TEXT PRIMARY KEY,
    deployment_id TEXT NOT NULL REFERENCES deployments(id) ON DELETE CASCADE,
    path TEXT NOT NULL UNIQUE,      -- '/apps/grafana'
    upstream TEXT NOT NULL,         -- 'http://10.0.0.11:3000'
    active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Command log
CREATE TABLE command_log (
    id TEXT PRIMARY KEY,
    server_id TEXT NOT NULL,
    deployment_id TEXT,
    action TEXT NOT NULL,
    payload JSON,
    status TEXT,
    result_message TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP
);

-- Initialize core on first run
INSERT INTO servers (id, name, is_core, agent_status)
VALUES ('core', 'core', TRUE, 'offline');
```

## API Endpoints

```
REST API:

Servers:
  GET    /api/servers               List all servers
  POST   /api/servers               Add server (returns bootstrap command)
  GET    /api/servers/:id           Get server details
  PUT    /api/servers/:id           Update server
  DELETE /api/servers/:id           Remove server

Apps (registry):
  GET    /api/apps                  List available apps
  GET    /api/apps/:name            Get app manifest
  GET    /api/apps/:name/versions   Get available versions

Deployments:
  GET    /api/deployments           List all deployments
  POST   /api/deployments           Install app
  GET    /api/deployments/:id       Get deployment details
  PUT    /api/deployments/:id       Update config
  POST   /api/deployments/:id/start Start app
  POST   /api/deployments/:id/stop  Stop app
  DELETE /api/deployments/:id       Uninstall app

Services:
  GET    /api/services              List available services
  GET    /api/services/:name        Get service providers

System:
  GET    /api/system/status         Overall status
  GET    /api/system/proxy-routes   Current proxy configuration

WebSocket Events:

Server → Client:
  server:status       Server metrics update
  server:connected    Server came online
  server:disconnected Server went offline
  deployment:status   Deployment status change
  command:result      Command completed

Client → Server:
  subscribe:server    Subscribe to server updates
  subscribe:logs      Subscribe to log stream
```

## Reverse Proxy

### URL Structure

```
https://ownprem.local/                  → Ownprem UI
https://ownprem.local/api/              → Orchestrator API
https://ownprem.local/apps/grafana/     → Grafana (proxied to server-1:3000)
https://ownprem.local/apps/adminer/     → Adminer (proxied to server-2:8080)
```

### Proxy Manager

```typescript
// apps/orchestrator/src/services/proxyManager.ts

export class ProxyManager {
  constructor(private db: Database) {}

  async updateRoutes() {
    const deployments = await this.db.query(`
      SELECT
        d.id,
        d.server_id,
        s.host,
        ar.manifest
      FROM deployments d
      JOIN servers s ON d.server_id = s.id
      JOIN app_registry ar ON d.app_name = ar.name
      WHERE d.status = 'running'
      AND JSON_EXTRACT(ar.manifest, '$.webui.enabled') = true
    `);

    const routes = deployments.map(d => {
      const webui = d.manifest.webui;
      const host = d.host || '127.0.0.1';
      return {
        path: webui.basePath,
        upstream: `http://${host}:${webui.port}`
      };
    });

    await this.writeCaddyConfig(routes);
    await this.reloadCaddy();
  }
}
```

## App Manifest Examples

### PostgreSQL

```yaml
# app-definitions/postgres/manifest.yaml

name: postgres
displayName: PostgreSQL
description: Advanced open source relational database
version: 16.2
category: database

source:
  type: apt
  package: postgresql-16

provides:
  - name: postgres-db
    port: 5432
    protocol: tcp
    credentials:
      type: password
      fields: [username, password]

configSchema:
  - name: max_connections
    type: number
    label: Max Connections
    default: 100
  - name: shared_buffers
    type: string
    label: Shared Buffers
    default: "256MB"
  - name: db_password
    type: password
    generated: true
    secret: true

resources:
  minDisk: 10GB
  minMemory: 512MB
```

### Redis

```yaml
# app-definitions/redis/manifest.yaml

name: redis
displayName: Redis
description: In-memory data structure store
version: 7.2.4
category: database

source:
  type: apt
  package: redis-server

provides:
  - name: redis-cache
    port: 6379
    protocol: tcp
    credentials:
      type: password
      fields: [password]

configSchema:
  - name: maxmemory
    type: string
    label: Max Memory
    default: "256mb"
  - name: redis_password
    type: password
    generated: true
    secret: true

resources:
  minMemory: 256MB
```

### Grafana

```yaml
# app-definitions/grafana/manifest.yaml

name: grafana
displayName: Grafana
description: Analytics and monitoring platform
version: 10.3.3
category: monitoring

source:
  type: binary
  downloadUrl: "https://dl.grafana.com/oss/release/grafana-${version}.linux-amd64.tar.gz"

requires:
  - service: postgres-db
    locality: any-server
    optional: true
    injectAs:
      host: GF_DATABASE_HOST
      port: GF_DATABASE_PORT
      credentials:
        username: GF_DATABASE_USER
        password: GF_DATABASE_PASSWORD

provides:
  - name: grafana-api
    port: 3000
    protocol: http

webui:
  enabled: true
  port: 3000
  basePath: /apps/grafana

configSchema:
  - name: admin_password
    type: password
    generated: true
    secret: true

resources:
  minDisk: 5GB
  minMemory: 256MB
```

## GUI Wireframes

### Dashboard

```
┌─────────────────────────────────────────────────────────────────────┐
│  Ownprem                                       admin ▼    ⚙️    │
├────────────┬────────────────────────────────────────────────────────┤
│            │                                                        │
│  Dashboard │  SERVERS                                               │
│  Servers   │  ┌─────────────────────────────────────────────────┐  │
│  Apps      │  │ ● core         local    agent ✓    1 app        │  │
│  Settings  │  │ ● server-1     online   agent ✓    2 apps       │  │
│            │  │ ● server-2     online   agent ✓    2 apps       │  │
│            │  │ ○ server-3     offline  agent ✗    -            │  │
│            │  └─────────────────────────────────────────────────┘  │
│            │                                                        │
│            │  APPS WITH WEB UI                                      │
│            │  ┌──────────┐  ┌──────────┐  ┌──────────┐            │
│            │  │ ░░░░░░░░ │  │ ░░░░░░░░ │  │ ░░░░░░░░ │            │
│            │  │ Grafana  │  │ Adminer  │  │ PgAdmin  │            │
│            │  │ server-1 │  │ server-2 │  │ server-1 │            │
│            │  │  [Open]  │  │  [Open]  │  │  [Open]  │            │
│            │  └──────────┘  └──────────┘  └──────────┘            │
│            │                                                        │
│            │  ALL DEPLOYMENTS                                       │
│            │  ┌─────────────────────────────────────────────────┐  │
│            │  │ App       Server     Status     Version         │  │
│            │  │ postgres  core       ● Running  16.2            │  │
│            │  │ redis     server-1   ● Running  7.2.4           │  │
│            │  │ grafana   server-1   ● Running  10.3.3          │  │
│            │  │ nginx     server-2   ● Running  1.24.0          │  │
│            │  │ adminer   server-2   ● Running  4.8.1           │  │
│            │  └─────────────────────────────────────────────────┘  │
└────────────┴────────────────────────────────────────────────────────┘
```

### Install App

```
┌─────────────────────────────────────────────────────────────────────┐
│  Install Grafana                                              [X]  │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Version:  [10.3.3 (latest) ▼]                                     │
│  Server:   [server-1 ▼]                                            │
│                                                                     │
│  DEPENDENCIES                                                       │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ ✓ postgres-db (optional)                                    │   │
│  │   Provided by: postgres on core (127.0.0.1:5432)           │   │
│  │   ⚠ Different server - connection via LAN                   │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  CONFIGURATION                                                      │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ Admin Password: [auto-generated]                            │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│                                      [Cancel]    [Install]         │
└─────────────────────────────────────────────────────────────────────┘
```

## Install Scripts

### Core (orchestrator + agent)

```bash
#!/bin/bash
# scripts/install.sh

set -e

echo "Installing Ownprem..."

# Install Node.js
curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
apt-get install -y nodejs

# Install Caddy
apt-get install -y debian-keyring debian-archive-keyring apt-transport-https curl
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/gpg.key' | gpg --dearmor -o /usr/share/keyrings/caddy-stable-archive-keyring.gpg
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt' | tee /etc/apt/sources.list.d/caddy-stable.list
apt-get update
apt-get install -y caddy

# Create directories
mkdir -p /opt/ownprem/{orchestrator,agent,ui,apps}
mkdir -p /var/lib/ownprem
mkdir -p /etc/ownprem

# Clone/pull repo
cd /opt/ownprem
git clone https://github.com/yourname/ownprem.git repo || (cd repo && git pull)

# Build
cd repo
npm install
npm run build

# Copy built files
cp -r apps/orchestrator/dist/* /opt/ownprem/orchestrator/
cp -r apps/agent/dist/* /opt/ownprem/agent/
cp -r apps/ui/dist/* /opt/ownprem/ui/

# Generate secrets key
SECRETS_KEY=$(openssl rand -hex 32)

# Config
cat > /etc/ownprem/orchestrator.env << EOF
NODE_ENV=production
PORT=3001
DATABASE_PATH=/var/lib/ownprem/db.sqlite
SECRETS_KEY=${SECRETS_KEY}
EOF

cat > /etc/ownprem/agent.env << EOF
SERVER_ID=core
ORCHESTRATOR_URL=http://localhost:3001
EOF

# Systemd services
systemctl daemon-reload
systemctl enable ownprem-orchestrator ownprem-agent caddy
systemctl start ownprem-orchestrator ownprem-agent caddy

IP=$(hostname -I | awk '{print $1}')
echo ""
echo "Ownprem installed!"
echo "Access at: http://${IP}:3000"
```

## Mock App for Testing

Use mock apps during development to test the platform:

```yaml
# app-definitions/mock-app/manifest.yaml

name: mock-app
displayName: Mock App
description: Simple test app for platform development
version: 1.0.0
category: utility

provides:
  - name: mock-service
    port: 9999
    protocol: http

webui:
  enabled: true
  port: 9999
  basePath: /apps/mock-app

configSchema:
  - name: message
    type: string
    label: Welcome Message
    default: "Hello from Mock App"
```

## Mock Dependency App

Test dependency resolution with a second mock app:

```yaml
# app-definitions/mock-dependent/manifest.yaml

name: mock-dependent
displayName: Mock Dependent App
version: 1.0.0
category: utility

requires:
  - service: mock-service
    locality: any-server
    injectAs:
      host: UPSTREAM_HOST
      port: UPSTREAM_PORT

provides:
  - name: mock-dependent-service
    port: 9998
    protocol: http

webui:
  enabled: true
  port: 9998
  basePath: /apps/mock-dependent

configSchema:
  - name: UPSTREAM_HOST
    type: string
    label: Upstream Host
  - name: UPSTREAM_PORT
    type: number
    label: Upstream Port
```

This lets you test the full dependency chain without any specific application dependencies.
